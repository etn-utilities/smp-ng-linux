// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright 2019 NXP
 * Copyright 2019-2021 Variscite Ltd.
 * Copyright 2021 Eaton
 */

/*
#include "imx8mm-var-dart-dt8mcustomboard-legacy-m4.dts x"
    #include "imx8mm-var-dart-dt8mcustomboard-legacy.dts x"
        #include "imx8mm-var-dart.dtsi x"
        #include "imx8mm-var-dart-dt8mcustomboard-common.dtsi x"

    #include "imx8mm-var-dart-dt8mcustomboard-m4.dtsi x"
*/

/*
 * ATTENTION: M4 may use IPs. They must be disabled in the device tree.
 * EX: ECSPI1, GPIO4, GPT1, I2C4, WDOG1, PWM3, SDMA1/3, UART3
*/


// Base dtsi.
// Note: includes imx8mm.dtsi
#include "imx8mm-var-dart.dtsi"


// DA3050 specific settings
//////////////////////////////////////////////////

&sdma1{
    status = "okay";
};

&ecspi1 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_ecspi1>;
    cs-gpios = <&gpio5 9 GPIO_ACTIVE_LOW>;
    status = "disabled";

    /* Test SPI device */
    spidev1@0 {
        reg = <0>;
        compatible = "var,spidev";
        spi-max-frequency = <12000000>;
        status = "disabled";
    };
};

&ecspi3 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_ecspi3>;
    cs-gpios = <&gpio5 25 GPIO_ACTIVE_LOW>;
    status = "okay";

    /* Test SPI device */
    spidev2@0 {
        reg = <0>;
        compatible = "var,spidev";
        spi-max-frequency = <12000000>;
        status = "okay";
    };
};

&i2c1 {
    // command parameters define in base file

    // Riverdi screen timmings
    dsi_lvds_bridge: sn65dsi84@2c {
        compatible = "ti,sn65dsi83";
        reg = <0x2c>;
        ti,dsi-lanes = <4>;
        ti,lvds-format = <0>;
        ti,lvds-bpp = <24>;
        ti,lvds-channels = <1>;
        ti,width-mm = <154>;
        ti,height-mm = <86>;
        enable-gpios = <&gpio2 11 GPIO_ACTIVE_HIGH>;
        enable-panel-gpios = <&gpio4 25 GPIO_ACTIVE_HIGH>;
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_lvds>;
        status = "okay";

        display-timings {
            lvds {
                clock-frequency = <51200000>;
                hactive = <1024>;
                vactive = <600>;
                hback-porch = <160>;
                hfront-porch = <160>;
                vback-porch = <23>;
                vfront-porch = <12>;
                hsync-len = <70>;
                vsync-len = <10>;
                hsync-active = <0>;
                vsync-active = <0>;
                de-active = <1>;
                pixelclk-active = <0>;
            };
        };

        port {
            dsi_lvds_bridge_in: endpoint {
                remote-endpoint = <&mipi_dsi_out>;
            };
        };
    };
};

&i2c2 {
    clock-frequency = <100000>;
    pinctrl-names = "default", "gpio";
    pinctrl-0 = <&pinctrl_i2c2>;
    pinctrl-1 = <&pinctrl_i2c2_gpio>;
    scl-gpios = <&gpio5 16 GPIO_ACTIVE_HIGH>;
    sda-gpios = <&gpio5 17 GPIO_ACTIVE_HIGH>;
    status = "okay";

	rtc@51 {
        status = "okay";
		compatible = "nxp,pcf8563";
		reg = <0x51>;
    };

    /*
	tcg-tpm@2E {
        status = "okay";
		compatible = "st,st33htpm-i2c";
		reg = <0x2E>;
    };
    */
};

&i2c3 {
    // command parameters define in base file

	ilitek2132touch: ilitek2132touch@41 {
		status = "okay";
		compatible = "ilitek,ili2132";
		reg = <0x41>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_ilitek2132>;
		interrupt-parent = <&gpio1>;
		interrupts = <3 IRQ_TYPE_EDGE_FALLING>;
        //reset-gpios = <&gpiox xx GPIO_ACTIVE_LOW>;
		touchscreen-size-x = <1024>;
		touchscreen-size-y = <600>;
		wakeup-source;
	};

    tsc2007touch: tsc2007touch@4b {
        status = "disabled";
        compatible = "ti,tsc2007";
        reg = <0x4b>;
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_tsc2007>;
        interrupt-parent = <&gpio1>;
        interrupts = <3 IRQ_TYPE_EDGE_FALLING>;
        gpios = <&gpio1 3 GPIO_ACTIVE_LOW>;

        ti,x-plate-ohms = <660>;
        ti,min-x = <35>;
        ti,max-x = <4060>;
        ti,min-y = <35>;
        ti,max-y = <4060>;
        ti,printPos = <1>;

        touchscreen-size-x = <1024>;
        touchscreen-fuzz-x = <2>;
        touchscreen-size-y = <600>;
        touchscreen-fuzz-y = <2>;

        touchscreen-inverted-x;
        touchscreen-inverted-y;

        wakeup-source;
	};

	/* AD5259 Digital Potentiometer display backlight control */
	ad5259@18 {
		status = "ok";
		compatible = "ad_dpot,ad5259";
		reg = <0x18>;
    };

	wm8904: audio-codec@1a {
		status = "disabled";
    };
};

&i2c4 {
    clock-frequency = <100000>;
    pinctrl-names = "default", "gpio";
    pinctrl-0 = <&pinctrl_i2c4>;
    pinctrl-1 = <&pinctrl_i2c4_gpio>;
    scl-gpios = <&gpio5 20 GPIO_ACTIVE_HIGH>;
    sda-gpios = <&gpio5 21 GPIO_ACTIVE_HIGH>;
    status = "okay";

    dummy@60 {
        compatible = "dummy";
        reg = <0x60>;
    };
};

&pcie0 {
    clocks = <&clk IMX8MM_CLK_PCIE1_ROOT>,
         <&clk IMX8MM_CLK_PCIE1_AUX>,
         <&clk IMX8MM_CLK_PCIE1_PHY>,
         <&pcie0_refclk>;
    clock-names = "pcie", "pcie_aux", "pcie_phy", "pcie_bus";
    ext_osc = <1>;
    status = "okay";

    //pinctrl-names = "default";
    //pinctrl-0 = <&pinctrl_pcie0>;
    //reset-gpio = <&gpio4 7 GPIO_ACTIVE_LOW>;
};

/* No master power key*/
&snvs_pwrkey {
    status = "disabled";
};

&snvs_rtc {
    status = "disabled";
};

/* Console */
&uart1 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_uart1>;
    status = "okay";
};

/* COM1 */
&uart2 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_uart2>, <&pinctrl_uart2_ext>;
    status = "okay";
    rs232_enable-gpio   = <&gpio4 27 GPIO_ACTIVE_HIGH>;
    rs485_enable-gpio	= <&gpio4 18 GPIO_ACTIVE_HIGH>;
    irigout_enable-gpio = <&gpio5 1 GPIO_ACTIVE_HIGH>;

    dcd-gpios = <&gpio4  8 GPIO_ACTIVE_LOW>;
    dsr-gpios = <&gpio4 10 GPIO_ACTIVE_LOW>;
    dtr-gpios = <&gpio4  9 GPIO_ACTIVE_LOW>;
    rng-gpios = <&gpio4 11 GPIO_ACTIVE_LOW>;

	uart-has-rtscts;
    rs485-rts-active-low;
	//rts-gpios = <&gpio4 30 GPIO_ACTIVE_LOW>;
    //cts-gpios = <&gpio4 29 GPIO_ACTIVE_LOW>;

	//cts-gpios = <&gpioY Z GPIO_ACTIVE_HIGH>;                  /* Add rts-gpios property NOT for imx8 uart could, be used to add dcd...*/
	//rts-gpios = <&gpioY Z GPIO_ACTIVE_HIGH>;                  /* Add rts-gpios property */
 	//linux,rs485-enabled-at-boot-time;  						/* Enable RS485 at boot time to skip using TIOCSRS485 ioctl */
    //linux,rs485-rx-during-tx;
    //linux,rs485-rts-active-low;
};

/* PSOC */
&uart3 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_uart3>;
    status = "okay";
};

/* COM2/Bluetooth
pinctrl-0 = <&pinctrl_uart4>, <&pinctrl_uart4_ext>, <&pinctrl_bt>;
*/
&uart4 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_uart4>, <&pinctrl_uart4_ext>;
    assigned-clocks = <&clk IMX8MM_CLK_UART4>;
    assigned-clock-parents = <&clk IMX8MM_SYS_PLL1_80M>;
    status = "okay";
    rs232_enable-gpio   = <&gpio1 15 GPIO_ACTIVE_HIGH>;
    rs485_enable-gpio	= <&gpio4 19 GPIO_ACTIVE_HIGH>;
    irigout_enable-gpio = <&gpio5 28 GPIO_ACTIVE_HIGH>;

    dcd-gpios = <&gpio4 12 GPIO_ACTIVE_LOW>;
    dsr-gpios = <&gpio4 0 GPIO_ACTIVE_LOW>;
    dtr-gpios = <&gpio4 13 GPIO_ACTIVE_LOW>;
    rng-gpios = <&gpio4 15 GPIO_ACTIVE_LOW>;

	uart-has-rtscts;
    rs485-rts-active-low;
	//rts-gpios = <&gpiox x GPIO_ACTIVE_LOW>;
    //cts-gpios = <&gpiox x GPIO_ACTIVE_LOW>;
};

&usbotg1 {
    dr_mode = "peripheral";
    picophy,pre-emp-curr-control = <3>;
    picophy,dc-vol-level-adjust = <7>;
    status = "okay";
};

&usbotg2 {
    dr_mode = "host";
    picophy,pre-emp-curr-control = <3>;
    picophy,dc-vol-level-adjust = <7>;
    status = "okay";
};

/* SD */
&usdhc2 {
    pinctrl-names = "default", "state_100mhz", "state_200mhz";
    pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
    pinctrl-1 = <&pinctrl_usdhc2_100mhz>, <&pinctrl_usdhc2_gpio>;
    pinctrl-2 = <&pinctrl_usdhc2_200mhz>, <&pinctrl_usdhc2_gpio>;
    cd-gpios = <&gpio2 12 GPIO_ACTIVE_LOW>;
    no-1-8-v;
    status = "okay";
};

&rpmsg{
    compatible = "fsl,imx8mm-rpmsg";
    /*
     * 64K for one rpmsg instance:
     * --0x40000000~0x4000ffff: pingpong
     */
    vdev-nums = <1>;
    reg = <0x0 0x40000000 0x0 0x10000>;
    memory-region = <&vdevbuffer>;
    status = "okay";
};

&fec1 {
    pinctrl-names = "default", "sleep";
    pinctrl-0 = <&pinctrl_fec1>, <&pinctrl_fec1_ext>;
    pinctrl-1 = <&pinctrl_fec1>, <&pinctrl_fec1_ext>;
    //pinctrl-1 = <&pinctrl_fec1_sleep>, <&pinctrl_fec1_ext_sleep>;
    phy-mode = "rmii";
    phy-handle = <&ethphy0>;
	phy-supply = <&reg_eth_phy>;
    phy-reset-gpios = <&gpio4 28 GPIO_ACTIVE_LOW>;
    phy-reset-duration = <20>;
    phy-reset-on-resume;
    status = "okay";

    clocks = <&clk IMX8MM_CLK_ENET1_ROOT>,
            <&clk IMX8MM_CLK_ENET1_ROOT>,
            <&clk IMX8MM_CLK_ENET_TIMER>,
            <&clk IMX8MM_CLK_ENET_REF>,
            <&clk IMX8MM_CLK_ENET_PHY_REF>;

    clock-names = "ipg", "ahb", "ptp",
                "enet_clk_ref", "enet_out";

    assigned-clocks = <&clk IMX8MM_CLK_ENET_AXI>,
                <&clk IMX8MM_CLK_ENET_TIMER>,
                <&clk IMX8MM_CLK_ENET_REF>,
                <&clk IMX8MM_CLK_ENET_TIMER>;

    assigned-clock-parents = <&clk IMX8MM_SYS_PLL1_266M>,
                    <&clk IMX8MM_SYS_PLL2_100M>,
                    <&clk IMX8MM_SYS_PLL2_50M>;

    assigned-clock-rates = <0>, <0>, <50000000>, <100000000>;

    fixed-link {
        speed = <100>;
        full-duplex;
    };

    mdio {
        #address-cells = <1>;
        #size-cells = <0>;
        ethphy0: ethernet-phy@0 {
            compatible = "ethernet-phy-ieee802.3-c22";
            reg = <1>;
            max-speed = <100>;
        };
    };
};

&sai3 {
    status = "diasbled";
};

/*
// Add RDC registers for GPIO access protection
&gpio1 {
    reg = <0x30200000 0x10000>, <0x303D0000 0x10000>, <0x303B0000 0x1>;
    reg-names = "gpio_base", "rdc_base", "sem_base";
    clocks = <&clk IMX8MM_CLK_GPIO1_ROOT>, <&clk IMX8MM_CLK_RDC_ROOT>, <&clk IMX8MM_CLK_SEMA42_1_ROOT>;
    clock-names = "gpio", "rdc", "sem";
};

&gpio2 {
    reg = <0x30210000 0x10000>, <0x303B0001 0x1>;
    reg-names = "gpio_base", "sem_base";
    clocks = <&clk IMX8MM_CLK_GPIO2_ROOT>, <&clk IMX8MM_CLK_RDC_ROOT>, <&clk IMX8MM_CLK_SEMA42_1_ROOT>;
	clock-names = "gpio", "rdc", "sem";
};

&gpio3 {
    reg = <0x30220000 0x10000>, <0x303B0002 0x1>;
    reg-names = "gpio_base", "sem_base";
    clocks = <&clk IMX8MM_CLK_GPIO3_ROOT>, <&clk IMX8MM_CLK_RDC_ROOT>, <&clk IMX8MM_CLK_SEMA42_1_ROOT>;
	clock-names = "gpio", "rdc", "sem";
};

&gpio4 {
    reg = <0x30230000 0x10000>, <0x303B0003 0x1>;
    reg-names = "gpio_base", "sem_base";
    clocks = <&clk IMX8MM_CLK_GPIO4_ROOT>, <&clk IMX8MM_CLK_RDC_ROOT>, <&clk IMX8MM_CLK_SEMA42_1_ROOT>;
	clock-names = "gpio", "rdc", "sem";
};

&gpio5 {
    reg = <0x30240000 0x10000>, <0x303B0004 0x1>;
    reg-names = "gpio_base", "sem_base";
    clocks = <&clk IMX8MM_CLK_GPIO5_ROOT>, <&clk IMX8MM_CLK_RDC_ROOT>, <&clk IMX8MM_CLK_SEMA42_1_ROOT>;
	clock-names = "gpio", "rdc", "sem";
};
*/

// Removed from Linux side, used exclusively by M4
&gpio3 {
    status = "disabled";
};



// New pad control definition to add SION bit set to 1
// See IOMUXC_SW_MUX_CTL_PAD_ENET_TD2 register definition in imx8mm documentation IMX8MMRM
// Could also have been done with NXP ugly 0x40000000 patch
#define MX8MM_IOMUXC_ENET_TD2_ENET1_TX_CLK_EX   0x074 0x2DC 0x000 0x11 0x0
&iomuxc {
    pinctrl-names = "default";

    // These are used to select boot source at startup
    pinctrl_donotusegpios: donotusegpiosgrp {
        fsl,pins = <
            MX8MM_IOMUXC_SAI1_TXD2_GPIO4_IO14       0x14
            MX8MM_IOMUXC_SAI1_TXD4_GPIO4_IO16       0x14
            MX8MM_IOMUXC_SAI1_TXD5_GPIO4_IO17       0x14
        >;
    };

    pinctrl_freegpios: freegpiosgrp {
        fsl,pins = <
			MX8MM_IOMUXC_UART4_TXD_GPIO5_IO29		0x14
			MX8MM_IOMUXC_GPIO1_IO12_GPIO1_IO12		0x14    /* Display fault */
        >;
    };

    pinctrl_bt: btgrp {
        fsl,pins = <
			MX8MM_IOMUXC_SD1_DATA4_GPIO2_IO6		0x14	/* BT_REG_ON       */
			MX8MM_IOMUXC_SPDIF_EXT_CLK_GPIO5_IO5	0x14	/* BT_BUF_EN       */
        >;
    };

    pinctrl_tsc2007: tsc2007grp {
        fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO03_GPIO1_IO3		0x14
        >;
    };

    pinctrl_ilitek2132: ilitek2132grp {
        fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO03_GPIO1_IO3		0x14
        >;
    };

    pinctrl_cellmodem: cellmodemgrp {
        // CELL_OFF CELL_RST_B CELL_STATUS_B
        fsl,pins = <
			MX8MM_IOMUXC_SAI1_MCLK_GPIO4_IO20		0x14
			MX8MM_IOMUXC_SPDIF_RX_GPIO5_IO4			0x14
			MX8MM_IOMUXC_SPDIF_TX_GPIO5_IO3			0x14
        >;
    };

    pinctrl_expensiongpios: expensiongpiosgrp {
        fsl,pins = <
			MX8MM_IOMUXC_SAI1_RXD1_GPIO4_IO3		0x14
			MX8MM_IOMUXC_SAI1_RXD2_GPIO4_IO4		0x14
            MX8MM_IOMUXC_SAI1_RXD0_GPIO4_IO2        0x14
        >;
    };

    pinctrl_gps: gpsgrp {
        fsl,pins = <
            MX8MM_IOMUXC_GPIO1_IO01_GPIO1_IO1       0x14
        >;
        //MX8MM_IOMUXC_SAI2_RXD0_GPIO4_IO23		0x14
    };

    pinctrl_ppscpu: ppscpugrp {
        fsl,pins = <
			MX8MM_IOMUXC_SAI1_RXD3_GPIO4_IO5		0x14
        >;
    };

    /*
    pinctrl_pps_gen: ppsgengrp {
        fsl,pins = <
			MX8MM_IOMUXC_GPIO4_IO05_GPIO4_IO5		0x14
        >;
    };
    */

    pinctrl_gpioled: gpioledgrp {
        // SYNC_GREEN, SYNC_RED, PF_LATCH, PF_LATCH_CLR, TEST_LED, BTN
        fsl,pins = <
            MX8MM_IOMUXC_GPIO1_IO13_GPIO1_IO13      0x14
            MX8MM_IOMUXC_GPIO1_IO14_GPIO1_IO14      0x14
			MX8MM_IOMUXC_GPIO1_IO11_GPIO1_IO11		0x14
			MX8MM_IOMUXC_SAI1_RXC_GPIO4_IO1			0x14
			MX8MM_IOMUXC_GPIO1_IO05_GPIO1_IO5		0x14
			MX8MM_IOMUXC_GPIO1_IO00_GPIO1_IO0		0x14
        >;
    };
    
    pinctrl_pwrsupply: pwrsupplygrp {
        fsl,pins = <
			MX8MM_IOMUXC_SAI2_TXFS_GPIO4_IO24		0x14
        >;
    };

    pinctrl_psoc: psocgrp {
        fsl,pins = <
			MX8MM_IOMUXC_SAI1_RXD4_GPIO4_IO6	0x14
			MX8MM_IOMUXC_SAI1_RXD5_GPIO4_IO7	0x14
        >;
    };

    pinctrl_fec1: fec1grp {
        fsl,pins = <
 			MX8MM_IOMUXC_ENET_MDC_ENET1_MDC				0x02
			MX8MM_IOMUXC_ENET_MDIO_ENET1_MDIO			0x02
			MX8MM_IOMUXC_ENET_TD1_ENET1_RGMII_TD1		0x16
			MX8MM_IOMUXC_ENET_TD0_ENET1_RGMII_TD0		0x16
			MX8MM_IOMUXC_ENET_RD1_ENET1_RGMII_RD1		0x90
			MX8MM_IOMUXC_ENET_RD0_ENET1_RGMII_RD0		0x90
			MX8MM_IOMUXC_ENET_RX_CTL_ENET1_RGMII_RX_CTL	0x90
			MX8MM_IOMUXC_ENET_TX_CTL_ENET1_RGMII_TX_CTL	0x16
			MX8MM_IOMUXC_ENET_TD2_ENET1_TX_CLK_EX		0x16
            MX8MM_IOMUXC_SAI3_RXFS_GPIO4_IO28           0x14
        >;
        //MX8MM_IOMUXC_GPIO1_IO09_GPIO1_IO9         0x10  //reserved on dart for onboard phy if present
    };

    pinctrl_fec1_ext: fec1extgrp {
        fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO10_GPIO1_IO10				0x14        /*ENET_LC_B*/
			MX8MM_IOMUXC_GPIO1_IO08_ENET1_1588_EVENT0_IN	0x14
			MX8MM_IOMUXC_SAI3_MCLK_GPIO5_IO2				0x14        /*ENET1_PPS_IN*/
        >;
		//MX8MM_IOMUXC_ENET_TXC_GPIO1_IO23				0x120
		//MX8MM_IOMUXC_ENET_RXC_GPIO1_IO25				0x120
    };

    pinctrl_fec1_sleep: fec1grpsleep {
        fsl,pins = <
			MX8MM_IOMUXC_ENET_MDC_GPIO1_IO16		0x120
			MX8MM_IOMUXC_ENET_MDIO_GPIO1_IO17		0x120
			MX8MM_IOMUXC_ENET_TD1_GPIO1_IO20		0x120
			MX8MM_IOMUXC_ENET_TD0_GPIO1_IO21		0x120
			MX8MM_IOMUXC_ENET_RD1_GPIO1_IO27		0x120
			MX8MM_IOMUXC_ENET_RD0_GPIO1_IO26		0x120
			MX8MM_IOMUXC_ENET_RX_CTL_GPIO1_IO24		0x120
			MX8MM_IOMUXC_ENET_TX_CTL_GPIO1_IO22		0x120
			MX8MM_IOMUXC_ENET_TD2_GPIO1_IO19		0x120
            MX8MM_IOMUXC_SAI3_RXFS_GPIO4_IO28       0x10
        >;
		//MX8MM_IOMUXC_GPIO1_IO09_GPIO1_IO9		0x120
    };

    pinctrl_fec1_ext_sleep: fec1extsleepgrp {
        fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO10_GPIO1_IO10				0x10
			MX8MM_IOMUXC_GPIO1_IO08_ENET1_1588_EVENT0_IN	0x10
			MX8MM_IOMUXC_SAI3_MCLK_GPIO5_IO2				0x10
        >;
        //MX8MM_IOMUXC_ENET_TXC_GPIO1_IO23				0x120
        //MX8MM_IOMUXC_ENET_RXC_GPIO1_IO25				0x120
    };

    pinctrl_lvds: lvdsgrp {
        fsl,pins = <
			MX8MM_IOMUXC_SD1_STROBE_GPIO2_IO11		0x16
			MX8MM_IOMUXC_SAI2_TXC_GPIO4_IO25		0x14		/*PWR_EN*/
        >;
    };

    pinctrl_ecspi1: ecspi1grp {
        // IOs Reserved for M4 not used by A53
        fsl,pins = <
			MX8MM_IOMUXC_ECSPI1_SCLK_ECSPI1_SCLK	0x12
			MX8MM_IOMUXC_ECSPI1_MOSI_ECSPI1_MOSI	0x12
			MX8MM_IOMUXC_ECSPI1_MISO_ECSPI1_MISO	0x12
			MX8MM_IOMUXC_ECSPI1_SS0_GPIO5_IO9		0x14
        >;
    };

    pinctrl_ecspi3: ecspi3grp {
        // FRAM
        fsl,pins = <
			MX8MM_IOMUXC_UART2_RXD_ECSPI3_MISO		0x12
			MX8MM_IOMUXC_UART1_TXD_ECSPI3_MOSI		0x12
			MX8MM_IOMUXC_UART1_RXD_ECSPI3_SCLK		0x12
			MX8MM_IOMUXC_UART2_TXD_GPIO5_IO25		0x14
        >;
    };

    pinctrl_i2c1: i2c1grp {
        // WARNIG!!!  Although not documented the 0x40000000 bit is necessary
        // See IMX_PAD_SION in linux-variscite/drivers/pinctrl/freescale/pinctrl-imx.c
        // This is a patch from NXP to override the SION bit in the MUX control register.
        fsl,pins = <
			MX8MM_IOMUXC_I2C1_SCL_I2C1_SCL			0x400001c2
			MX8MM_IOMUXC_I2C1_SDA_I2C1_SDA			0x400001c2
        >;
    };

    pinctrl_i2c1_gpio: i2c1grp-gpio {
        fsl,pins = <
			MX8MM_IOMUXC_I2C1_SCL_GPIO5_IO14		0x1c2
			MX8MM_IOMUXC_I2C1_SDA_GPIO5_IO15		0x1c2
        >;
    };

    pinctrl_i2c2: i2c2grp {
        // WARNIG!!!  Although not documented the 0x40000000 bit is necessary
        // See IMX_PAD_SION in linux-variscite/drivers/pinctrl/freescale/pinctrl-imx.c
        // This is a patch from NXP to override the SION bit in the MUX control register.
        fsl,pins = <
			MX8MM_IOMUXC_I2C2_SCL_I2C2_SCL			0x400001c2
			MX8MM_IOMUXC_I2C2_SDA_I2C2_SDA			0x400001c2
        >;
    };

    pinctrl_i2c2_gpio: i2c2grp-gpio {
        fsl,pins = <
			MX8MM_IOMUXC_I2C2_SCL_GPIO5_IO16		0x1c2
			MX8MM_IOMUXC_I2C2_SDA_GPIO5_IO17		0x1c2
        >;
    };

    pinctrl_i2c3: i2c3grp {
        // WARNIG!!!  Although not documented the 0x40000000 bit is necessary
        // See IMX_PAD_SION in linux-variscite/drivers/pinctrl/freescale/pinctrl-imx.c
        // This is a patch from NXP to override the SION bit in the MUX control register.
        fsl,pins = <
			MX8MM_IOMUXC_I2C3_SCL_I2C3_SCL			0x400001c2
			MX8MM_IOMUXC_I2C3_SDA_I2C3_SDA			0x400001c2
        >;
    };

    pinctrl_i2c3_gpio: i2c3grp-gpio {
        fsl,pins = <
			MX8MM_IOMUXC_I2C3_SCL_GPIO5_IO18		0x1c2
			MX8MM_IOMUXC_I2C3_SDA_GPIO5_IO19		0x1c2
        >;
    };

    pinctrl_i2c4: i2c4grp {
        // WARNIG!!!  Although not documented the 0x40000000 bit is necessary
        // See IMX_PAD_SION in linux-variscite/drivers/pinctrl/freescale/pinctrl-imx.c
        // This is a patch from NXP to override the SION bit in the MUX control register.
        fsl,pins = <
			MX8MM_IOMUXC_I2C4_SCL_I2C4_SCL			0x400001c2
			MX8MM_IOMUXC_I2C4_SDA_I2C4_SDA			0x400001c2
        >;
    };

    pinctrl_i2c4_gpio: i2c4grp-gpio {
        fsl,pins = <
			MX8MM_IOMUXC_I2C4_SCL_GPIO5_IO20		0x1c2
			MX8MM_IOMUXC_I2C4_SDA_GPIO5_IO21		0x1c2
        >;
    };

    pinctrl_uart1: uart1grp {
        fsl,pins = <
			MX8MM_IOMUXC_SAI2_RXC_UART1_DCE_RX		0x100
			MX8MM_IOMUXC_SAI2_RXFS_UART1_DCE_TX		0x140
        >;
    };

    pinctrl_uart2: uart2grp {
        fsl,pins = <
			MX8MM_IOMUXC_SAI3_TXFS_UART2_DCE_RX		0x140
			MX8MM_IOMUXC_SAI3_TXC_UART2_DCE_TX		0x140
			MX8MM_IOMUXC_SAI3_RXC_UART2_DCE_CTS_B	0x140
			MX8MM_IOMUXC_SAI3_RXD_UART2_DCE_RTS_B	0x140
        >;
    };

    pinctrl_uart2_ext: uart2extgrp {
        /*  COM1_232_EN 
            COM1_485_EN 
            COM1_DSR 
            COM1_DTR 
            COM1_GPIO_DCD 
            COM1_GPIO_RI 
            COM1_IRIG_EN */
        fsl,pins = <
            MX8MM_IOMUXC_SAI2_MCLK_GPIO4_IO27       0x14
 			MX8MM_IOMUXC_SAI1_TXD6_GPIO4_IO18		0x14
			MX8MM_IOMUXC_SAI1_TXFS_GPIO4_IO10		0x14
			MX8MM_IOMUXC_SAI1_RXD7_GPIO4_IO9		0x14
			MX8MM_IOMUXC_SAI1_RXD6_GPIO4_IO8		0x14
			MX8MM_IOMUXC_SAI1_TXC_GPIO4_IO11		0x14
			MX8MM_IOMUXC_SAI3_TXD_GPIO5_IO1			0x14
        >;
    };

    pinctrl_uart3: uart3grp {
        fsl,pins = <
			MX8MM_IOMUXC_UART3_RXD_UART3_DCE_RX		0x140
			MX8MM_IOMUXC_UART3_TXD_UART3_DCE_TX		0x140
        >;
    };
    
    pinctrl_uart4: uart4grp {
        fsl,pins = <
			MX8MM_IOMUXC_ECSPI2_SCLK_UART4_DCE_RX		0x140
			MX8MM_IOMUXC_ECSPI2_MOSI_UART4_DCE_TX		0x140
			MX8MM_IOMUXC_ECSPI2_SS0_UART4_DCE_RTS_B		0x14
			MX8MM_IOMUXC_ECSPI2_MISO_UART4_DCE_CTS_B	0x14
        >;
    };

    pinctrl_uart4_ext: uart4extgrp {
        /*  COM2_232_EN 
            COM2_485_EN 
            COM2_DSR 
            COM2_DTR 
            COM2_GPIO_DCD 
            COM2_GPIO_RI 
            COM2_IRIG_EN */
        fsl,pins = <
            MX8MM_IOMUXC_GPIO1_IO15_GPIO1_IO15          0x14
			MX8MM_IOMUXC_SAI1_TXD7_GPIO4_IO19			0x14
            MX8MM_IOMUXC_SAI1_RXFS_GPIO4_IO0            0x14
			MX8MM_IOMUXC_SAI1_TXD1_GPIO4_IO13			0x14
			MX8MM_IOMUXC_SAI1_TXD0_GPIO4_IO12			0x14
			MX8MM_IOMUXC_SAI1_TXD3_GPIO4_IO15			0x14
			MX8MM_IOMUXC_UART4_RXD_GPIO5_IO28			0x14
        >;
    };

    pinctrl_usdhc2: usdhc2grp {
        fsl,pins = <
			MX8MM_IOMUXC_SD2_CLK_USDHC2_CLK				0x190
			MX8MM_IOMUXC_SD2_CMD_USDHC2_CMD				0x1d0
			MX8MM_IOMUXC_SD2_DATA0_USDHC2_DATA0			0x1d0
			MX8MM_IOMUXC_SD2_DATA1_USDHC2_DATA1			0x1d0
			MX8MM_IOMUXC_SD2_DATA2_USDHC2_DATA2			0x1d0
			MX8MM_IOMUXC_SD2_DATA3_USDHC2_DATA3			0x1d0
			MX8MM_IOMUXC_GPIO1_IO04_USDHC2_VSELECT		0x1d0
        >;
    };

    pinctrl_usdhc2_100mhz: usdhc2grp100mhz {
        fsl,pins = <
			MX8MM_IOMUXC_SD2_CLK_USDHC2_CLK				0x194
			MX8MM_IOMUXC_SD2_CMD_USDHC2_CMD				0x1d4
			MX8MM_IOMUXC_SD2_DATA0_USDHC2_DATA0			0x1d4
			MX8MM_IOMUXC_SD2_DATA1_USDHC2_DATA1			0x1d4
			MX8MM_IOMUXC_SD2_DATA2_USDHC2_DATA2			0x1d4
			MX8MM_IOMUXC_SD2_DATA3_USDHC2_DATA3			0x1d4
			MX8MM_IOMUXC_GPIO1_IO04_USDHC2_VSELECT		0x1d0
        >;
    };

    pinctrl_usdhc2_200mhz: usdhc2grp200mhz {
        fsl,pins = <
			MX8MM_IOMUXC_SD2_CLK_USDHC2_CLK				0x196
			MX8MM_IOMUXC_SD2_CMD_USDHC2_CMD				0x1d6
			MX8MM_IOMUXC_SD2_DATA0_USDHC2_DATA0			0x1d6
			MX8MM_IOMUXC_SD2_DATA1_USDHC2_DATA1			0x1d6
			MX8MM_IOMUXC_SD2_DATA2_USDHC2_DATA2			0x1d6
			MX8MM_IOMUXC_SD2_DATA3_USDHC2_DATA3			0x1d6
			MX8MM_IOMUXC_GPIO1_IO04_USDHC2_VSELECT		0x1d0
        >;
    };

    pinctrl_usdhc2_gpio: usdhc2grpgpio {
        fsl,pins = <
			MX8MM_IOMUXC_SD2_CD_B_GPIO2_IO12		0x80
        >;
    };

    /*
    // Reserved for M4
	pinctrl_m4cpu: m4cpugrp {
        fsl,pins = <
            MX8MM_IOMUXC_SAI5_RXFS_GPIO3_IO19   0x14    //SPI_FUNCT_MUX0
            MX8MM_IOMUXC_SAI5_RXD1_GPIO3_IO22   0x14    //SPI_FUNCT_MUX1
            MX8MM_IOMUXC_SAI5_RXD2_GPIO3_IO23   0x14    //SPI_FUNCT_MUX2

            MX8MM_IOMUXC_SAI5_RXD3_GPIO3_IO24   0x14    //SPI_SLOT_CS_MUX0_B
            MX8MM_IOMUXC_SAI5_RXC_GPIO3_IO20    0x14    //SPI_SLOT_CS_MUX1_B
            MX8MM_IOMUXC_SAI5_RXD0_GPIO3_IO21   0x14    //SPI_SLOT_CS_MUX2_B

			MX8MM_IOMUXC_SAI2_TXD0_GPIO4_IO26	0x14    //DELAY_RESET_B
            MX8MM_IOMUXC_SAI5_MCLK_GPIO3_IO25   0x14    //GPIO_PSOC_PPS_OUT
            MX8MM_IOMUXC_NAND_CE0_B_GPIO3_IO1   0x14    //GPIO_PUSH_BUTTON_B_1V8
        >;
    };
    */
};


/ {
    model = "Variscite DART-MX8M-MINI M4 on Eaton DA3050 carrier";

    chosen {
        stdout-path = &uart1;
    };

    pcie0_refclk: pcie0-refclk {
        compatible = "fixed-clock";
        #clock-cells = <0>;
        clock-frequency = <100000000>;
    };

    gpioled {
        compatible = "da3050_gpioled";
        pinctrl-names = "default";
        status = "okay";
        pinctrl-0 = <&pinctrl_gpioled>, <&pinctrl_cellmodem>;
        //pinctrl-0 = <&pinctrl_gpioled>, <&pinctrl_cellmodem>, <&pinctrl_expensiongpios>, <&pinctrl_freegpios>;

        led_sync_g-gpio = <&gpio1 13 GPIO_ACTIVE_HIGH>;
        led_sync_r-gpio = <&gpio1 14 GPIO_ACTIVE_HIGH>;
        pf_get-gpio     = <&gpio1 11 GPIO_ACTIVE_HIGH>;
        pf_clr-gpio     = <&gpio4  1 GPIO_ACTIVE_HIGH>;
        led_test-gpio   = <&gpio1  5 GPIO_ACTIVE_HIGH>;
        btn_get-gpio    = <&gpio1  0 GPIO_ACTIVE_HIGH>;

        cell_off_on-gpio =     <&gpio4 20 GPIO_ACTIVE_HIGH>;
        cell_reset_not-gpio =  <&gpio5 4 GPIO_ACTIVE_HIGH>;
        cell_status-gpio =     <&gpio5 3 GPIO_ACTIVE_HIGH>;

        /*
        Internal pull resistor test on inactive GPIOs!!!
        gpio1_12-gpio   = <&gpio1 12 GPIO_ACTIVE_HIGH>;
        gpio4_02-gpio   = <&gpio4  2 GPIO_ACTIVE_HIGH>;
        gpio4_03-gpio   = <&gpio4  3 GPIO_ACTIVE_HIGH>;
        gpio4_04-gpio   = <&gpio4  4 GPIO_ACTIVE_HIGH>;
        */
    };

    /*
    pps-gen {
        compatible = "pps-gen-gpio";
        status = "disabled";
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_pps_gen>;
        pps-gen-gpio = <&gpio1 5 GPIO_ACTIVE_HIGH>;
        default-state = "off";
    };
    */

    imx8mm-cm4 {
        compatible = "fsl,imx8mm-cm4";
        rsc-da = <0x40000000>;
        clocks = <&clk IMX8MM_CLK_M4_DIV>;
        mbox-names = "tx", "rx", "rxdb";
        mboxes = <&mu 0 1
              &mu 1 1
              &mu 3 1>;
        memory-region = <&vdev0vring0>, <&vdev0vring1>, <&vdevbuffer>, <&m4_reserved>;
        syscon = <&src>;
    };

    reserved-memory {
        m4_reserved: m4@0x7e000000 {
            no-map;
            reg = <0 0x7e000000 0 0x1000000>;
        };

        vdev0vring0: vdev0vring0@40000000 {
            compatible = "shared-dma-pool";
            reg = <0 0x40000000 0 0x8000>;
            no-map;
        };

        vdev0vring1: vdev0vring1@40008000 {
            compatible = "shared-dma-pool";
            reg = <0 0x40008000 0 0x8000>;
            no-map;
        };

        vdevbuffer: vdevbuffer@0x40400000 {
            compatible = "shared-dma-pool";
            reg = <0 0x40400000 0 0x100000>;
            no-map;
        };
    };

    thermal-zones {
        cpu-thermal {
            polling-delay-passive = <250>;
            polling-delay = <2000>;
            thermal-sensors = <&tmu>;
            trips {
                cpu_alert0: trip0 {
                    temperature = <95000>;
                    hysteresis = <2000>;
                    type = "passive";
                };

                cpu_crit0: trip1 {
                    temperature = <105000>;
                    hysteresis = <2000>;
                    type = "critical";
                };
            };

            cooling-maps {
                map0 {
                    trip = <&cpu_alert0>;
                    cooling-device =
                        <&A53_0 THERMAL_NO_LIMIT THERMAL_NO_LIMIT>,
                        <&A53_1 THERMAL_NO_LIMIT THERMAL_NO_LIMIT>,
                        <&A53_2 THERMAL_NO_LIMIT THERMAL_NO_LIMIT>,
                        <&A53_3 THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
                };
            };
        };
    };

	sound-wm8904 {
		status = "disabled";
	};

    gpio-pwrsupply {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_pwrsupply>;

        pwr {
            gpios = <&gpio4 24 GPIO_ACTIVE_HIGH>;
        };
    };


    gpio-free {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_freegpios>;

        free1 {
            gpios = <&gpio5 29 GPIO_ACTIVE_HIGH>;
        };

        /*
       free2 {
            gpios = <&gpio1 12 GPIO_ACTIVE_HIGH>;
        };
        */
    };

    gpio-expansions {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_expensiongpios>;

        exp1 {
            gpios = <&gpio4 3 GPIO_ACTIVE_HIGH>;
        };

        exp2 {
            gpios = <&gpio4 4 GPIO_ACTIVE_HIGH>;
        };

        exp3 {
            gpios = <&gpio4 2 GPIO_ACTIVE_HIGH>;
        };
    };

    gpio-gps {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_gps>;

        reset {
            gpios = <&gpio1 1 GPIO_ACTIVE_HIGH>;
        };

        /*
        pps_in {
            gpios = <&gpio4 23 GPIO_ACTIVE_HIGH>;
        };
        */
    };

    gpio-ppscpu {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_ppscpu>;

        pps_out {
            gpios = <&gpio4 5 GPIO_ACTIVE_HIGH>;
        };
    };

    gpio-psoc {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_psoc>;

        gpio1 {
            gpios = <&gpio4 6 GPIO_ACTIVE_HIGH>;
        };

        gpio2 {
            gpios = <&gpio4 7 GPIO_ACTIVE_HIGH>;
        };
    };

    /*
    gpio-cellmodem {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_cellmodem>;

        cell_off {
            gpios = <&gpio4 20 GPIO_ACTIVE_HIGH>;
        };

        cell_reset {
            gpios = <&gpio5 4 GPIO_ACTIVE_HIGH>;
        };

        cell_status {
            gpios = <&gpio5 3 GPIO_ACTIVE_HIGH>;
        };
    };
    */

    /*
    // Reserved for m4 CPU
	gpio-m4cpu {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_m4cpu>;

		delay_reset {
			gpios = <&gpio4 26 GPIO_ACTIVE_HIGH>;
		};

        btn_in {
            gpios = <&gpio3 1 GPIO_ACTIVE_LOW>;
        };

        pps_in {
            gpios = <&gpio3 25 GPIO_ACTIVE_HIGH>;
        };

        funct {
            mux0-gpios = <&gpio3 19 GPIO_ACTIVE_HIGH>;
            mux1-gpios = <&gpio3 22 GPIO_ACTIVE_HIGH>;
            mux2-gpios = <&gpio3 23 GPIO_ACTIVE_HIGH>;
        };

        slot {
            mux0-gpios = <&gpio3 24 GPIO_ACTIVE_HIGH>;
            mux1-gpios = <&gpio3 20 GPIO_ACTIVE_HIGH>;
            mux2-gpios = <&gpio3 21 GPIO_ACTIVE_HIGH>;
        };
    };
    */
};

&gpio1 {
    gpio-line-names =
    "01_00 BTN              ",
    "01_01 PSOC pps_in      ",
    "01_02                  ",
    "01_03 ilitek touch     ",
    "01_04                  ",
    "01_05 LED test         ",
    "01_06 free             ",
    "01_07                  ",
    "01_08                  ",
    "01_09 fec              ",
    "01_10 fec ?            ",
    "01_11 CR pf_latch      ",
    "01_12 free             ",
    "01_13 EXP FUNC mux3    ",
    "01_14 EXP SLOT mux0    ",
    "01_15 EXP SLOT mux1    ",
    "01_16                  ",
    "01_17                  ",
    "01_18                  ",
    "01_19                  ",
    "01_20                  ",
    "01_21                  ",
    "01_22                  ",
    "01_23 fec              ",
    "01_24                  ",
    "01_25 fec              ",
    "01_26                  ",
    "01_27                  ",
    "01_28                  ",
    "01_29                  ",
    "01_30                  ",
    "01_31                  ";
};

&gpio2 {
    gpio-line-names =
    "02_00                  ",
    "02_01                  ",
    "02_02                  ",
    "02_03                  ",
    "02_04                  ",
    "02_05                  ",
    "02_06 BT_REG_ON        ",
    "02_07                  ",
    "02_08                  ",
    "02_09                  ",
    "02_10                  ",
    "02_11 lvds             ",
    "02_12 usdhc2           ",
    "02_13                  ",
    "02_14                  ",
    "02_15                  ",
    "02_16                  ",
    "02_17                  ",
    "02_18                  ",
    "02_19 usdhc2           ",
    "02_20                  ",
    "02_21                  ",
    "02_22                  ",
    "02_23                  ",
    "02_24                  ",
    "02_25                  ",
    "02_26                  ",
    "02_27                  ",
    "02_28                  ",
    "02_29                  ",
    "02_30                  ",
    "02_31                  ";
};

&gpio3 {
    gpio-line-names =
    "03_00                  ",
    "03_01                  ",
    "03_02                  ",
    "03_03                  ",
    "03_04                  ",
    "03_05 cpu pps out      ",
    "03_06                  ",
    "03_07                  ",
    "03_08                  ",
    "03_09 fec ?            ",
    "03_10                  ",
    "03_11                  ",
    "03_12                  ",
    "03_13                  ",
    "03_14                  ",
    "03_15                  ",
    "03_16                  ",
    "03_17                  ",
    "03_18                  ",
    "03_19                  ",
    "03_20 LED wd_red       ",
    "03_21 LED wd_green     ",
    "03_22 EXP gpio3        ",
    "03_23 LED sync_green   ",
    "03_24 LED sync_red     ",
    "03_25 GPS reset        ",
    "03_26                  ",
    "03_27                  ",
    "03_28                  ",
    "03_29                  ",
    "03_30                  ",
    "03_31                  ";
};

&gpio4 {
    gpio-line-names =
    "04_00 free             ",
    "04_01 CR pf_latch_clr  ",
    "04_02 EXP FUNC mux1    ",
    "04_03 EXP gpio1        ",
    "04_04 EXP gpio2        ",
    "04_05 free             ",
    "04_06 PSOC gpio1       ",
    "04_07 PSOC gpio2       ",
    "04_08                  ",
    "04_09 CELL_OFF         ",
    "04_10                  ",
    "04_11                  ",
    "04_12                  ",
    "04_13                  ",
    "04_14                  ",
    "04_15                  ",
    "04_16                  ",
    "04_17                  ",
    "04_18                  ",
    "04_19                  ",
    "04_20                  ",
    "04_21                  ",
    "04_22                  ",
    "04_23 GPS pps_in       ",
    "04_24 pwr              ",
    "04_25 Display PWR_EN_B ",
    "04_26 CR delay_reset   ",
    "04_27 EXP SLOT mux3    ",
    "04_28 EXP FUNC mux0    ",
    "04_29                  ",
    "04_30                  ",
    "04_31                  ";
};

&gpio5 {
    gpio-line-names =
    "05_00                  ",
    "05_01                  ",
    "05_02 fec ?            ",
    "05_03 CELL_STATUS_B    ",
    "05_04 CELL_RST_B       ",
    "05_05 BT_BUF_EN        ",
    "05_06                  ",
    "05_07                  ",
    "05_08                  ",
    "05_09 ecspi1           ",
    "05_10                  ",
    "05_11                  ",
    "05_12                  ",
    "05_13                  ",
    "05_14                  ",
    "05_15                  ",
    "05_16                  ",
    "05_17                  ",
    "05_18                  ",
    "05_19                  ",
    "05_20                  ",
    "05_21                  ",
    "05_22                  ",
    "05_23                  ",
    "05_24                  ",
    "05_25 ecspi3           ",
    "05_26                  ",
    "05_27                  ",
    "05_28 free             ",
    "05_29                  ",
    "05_30                  ",
    "05_31                  ";
};
